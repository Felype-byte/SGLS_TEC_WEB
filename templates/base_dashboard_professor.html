<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}SGHL – Painel do Professor{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap & Ícones -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base_dashboard_professor.css') }}" />

  <style>
    /* Botões das modais topo com fundo branco e texto azul UFC */
    .topbar .btn-outline-info,
    .topbar .btn-outline-primary {
      background-color: #ffffff !important;
      color: #003F6F !important;
      border: 2px solid #003F6F !important;
      box-shadow: 0 1px 6px #003f6f33 !important;
      transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .topbar .btn-outline-info:hover,
    .topbar .btn-outline-primary:hover,
    .topbar .btn-outline-info:focus,
    .topbar .btn-outline-primary:focus {
      background-color: #002e53 !important;
      color: #ffffff !important;
      border-color: #002e53 !important;
      box-shadow: 0 6px 22px #002e531a !important;
    }

    /* Centralizar o rodapé no fundo da página */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .container-painel {
      flex: 1 0 auto;
    }
    footer {
      flex-shrink: 0;
      text-align: center;
      font-size: 0.9rem;
      color: #666666;
      background: #f4f7fb;
      padding: 15px 20px;
      border-top: 1.5px solid #c7d1df;
      letter-spacing: 0.04em;
      margin-top: 20px;
    }

    /* Ajuste para ícones no botão badge para melhorar alinhamento */
    .topbar .btn .badge {
      top: -6px !important;
      right: -10px !important;
    }
  </style>
</head>
<body>

  <!-- 🔝 Topbar -->
  <div class="topbar">
    <div>
      <h1>SGHL – Sistema de Gerenciamento de Laboratórios</h1>
      <span>👋 Olá, Prof. {{ current_user.professor.nome_completo }}</span>
    </div>
    <div class="logout d-flex">
      <button
        class="btn btn-outline-info btn-sm rounded position-relative px-3"
        data-toggle="modal"
        data-target="#modalSolicitacoesAlunos">
        <i class="bi bi-people mr-1"></i> Solicitações de Alunos
        {% if solicitacoes_pendentes and solicitacoes_pendentes|length > 0 %}
          <span class="badge badge-danger position-absolute"
                style="font-size:0.75rem;">
            {{ solicitacoes_pendentes|length }}
          </span>
        {% endif %}
      </button>

      <button
        class="btn btn-outline-primary btn-sm rounded ml-2 px-3"
        data-toggle="modal"
        data-target="#modalMinhasSolicitacoes">
        <i class="bi bi-clipboard mr-1"></i> Minhas Solicitações
      </button>

      <a class="btn btn-outline-secondary btn-sm rounded ml-2 px-3" href="{{ url_for('logout') }}">
        <i class="bi bi-box-arrow-right mr-1"></i> Sair
      </a>
    </div>
  </div>

  <!-- 📦 Painel principal -->
  <div class="container-painel" role="main">
    <div class="card shadow-sm rounded">
      <div class="card-body">
        <h4 class="mb-4">{% block page_title %}{% endblock %}</h4>
        {% block content %}{% endblock %}
      </div>
    </div>
  </div>

  <!-- 🔻 Rodapé -->
  <footer>
    SGHL | © 2025 – Divisão de Tecnologia da Informação – UFC Sobral
  </footer>

  <!-- 📋 Modal Minhas Solicitações -->
  <div class="modal fade" id="modalMinhasSolicitacoes" tabindex="-1" role="dialog" aria-labelledby="modalMinhasSolicitacoesLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content shadow rounded">
        <div class="modal-header">
          <h5 class="modal-title" id="modalMinhasSolicitacoesLabel">📋 Minhas Solicitações</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body overflow-auto" style="max-height: 60vh;">
          {% if solicitacoes %}
            <ul class="list-group">
              {% for s in solicitacoes %}
                <li class="list-group-item mb-3 p-3 rounded shadow-sm border border-light">
                  <p class="mb-1"><strong>📅 Data:</strong> {{ s.horario.data.strftime('%d/%m/%Y') }} — {{ s.horario.texto }}</p>
                  <p class="mb-1"><strong>🏫 Sala:</strong> {{ s.sala.nome_sala }} – Sala {{ s.sala.numero_sala }} – {{ s.sala.bloco }}</p>
                  {% if s.justificativa %}
                    <p class="mb-1"><strong>📝 Justificativa:</strong> {{ s.justificativa }}</p>
                  {% endif %}

                  <span class="badge py-2 px-3
                    {% if s.status == 'Pendente Tecnico' %}badge-warning
                    {% elif s.status == 'Agendado' %}badge-success
                    {% elif s.status == 'Negado Tecnico' %}badge-danger
                    {% else %}badge-secondary{% endif %}">
                    {% if s.status == 'Pendente Tecnico' %}🟡 Aguardando técnico
                    {% elif s.status == 'Agendado' %}✅ Confirmado
                    {% elif s.status == 'Negado Tecnico' %}❌ Recusado pelo técnico
                    {% else %}🔘 {{ s.status }}{% endif %}
                  </span>

                  {% if s.status in ['Pendente Tecnico', 'Agendado'] %}
                    <form method="POST" action="{{ url_for('professor.cancelar_solicitacao', id=s.id_solicitacao) }}"
                          class="mt-3"
                          onsubmit="return confirm('Deseja cancelar esta solicitação?')">
                      <button class="btn btn-sm btn-outline-danger px-3 rounded d-flex align-items-center">
                        <i class="bi bi-x-circle-fill mr-1"></i> Cancelar Solicitação
                      </button>
                    </form>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">Nenhuma solicitação feita até o momento.</p>
          {% endif %}
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 📥 Modal Solicitações de Alunos -->
  <div class="modal fade" id="modalSolicitacoesAlunos" tabindex="-1" role="dialog" aria-labelledby="modalSolicitacoesAlunosLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content shadow rounded">
        <div class="modal-header">
          <h5 class="modal-title">📨 Solicitações de Alunos</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body overflow-auto" style="max-height: 60vh;">
          {% if solicitacoes_pendentes %}
            <ul class="list-group">
              {% for s in solicitacoes_pendentes %}
                <li class="list-group-item mb-3 p-3 rounded shadow-sm border border-light">
                  <p class="mb-1"><strong>👤 Aluno:</strong> {{ s.aluno.nome_completo }}</p>
                  <p class="mb-1"><strong>🆔 Matrícula:</strong> {{ s.aluno.matricula }}</p>
                  <p class="mb-1"><strong>📅 Data:</strong> {{ s.horario.data.strftime('%d/%m/%Y') }} — {{ s.horario.texto }}</p>
                  <p class="mb-1"><strong>🏫 Sala:</strong> {{ s.sala.nome_sala }} – Sala {{ s.sala.numero_sala }} – {{ s.sala.bloco }}</p>
                  <p class="mb-2"><strong>📝 Justificativa:</strong>
                    {% if s.justificativa %}
                      {{ s.justificativa }}
                    {% else %}
                      <span class="text-muted">Não informada.</span>
                    {% endif %}
                  </p>

                  <div class="alert alert-warning d-flex align-items-start small mt-3 mb-2" role="alert">
                    <i class="bi bi-exclamation-triangle-fill mr-2" style="font-size: 1.3rem;"></i>
                    <div>
                      Ao aprovar esta solicitação, declaro estar ciente de que serei o responsável pelos equipamentos e materiais utilizados na sala durante o horário agendado.
                    </div>
                  </div>

                  <div class="mt-3 d-flex flex-wrap gap-2">
                    <form method="POST" action="{{ url_for('professor.aprovar_solicitacao', id=s.id_solicitacao) }}" class="mr-2">
                      <button class="btn btn-success btn-sm px-3 rounded d-flex align-items-center">
                        <i class="bi bi-check-circle-fill mr-1"></i> Aprovar
                      </button>
                    </form>
                    <form method="POST" action="{{ url_for('professor.recusar_solicitacao', id=s.id_solicitacao) }}">
                      <button class="btn btn-danger btn-sm px-3 rounded d-flex align-items-center">
                        <i class="bi bi-x-circle-fill mr-1"></i> Recusar
                      </button>
                    </form>
                  </div>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">Nenhuma solicitação pendente no momento.</p>
          {% endif %}
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Scripts -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

  {% block extra_scripts %}{% endblock %}
</body>
</html>
