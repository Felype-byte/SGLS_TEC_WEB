{% extends 'base_dashboard_aluno.html' %}

{% block title %}Painel do Aluno ‚Äì SGHL{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card shadow-sm p-4">
    <h4 class="mb-4">Painel do Aluno</h4>

    <form method="POST" action="{{ url_for('aluno.agendamento_aluno') }}">
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="sala_id"><strong>1. Escolha o Laborat√≥rio:</strong></label>
          <select name="sala_id" id="sala_id" class="form-control" required>
            <option selected disabled value="">Selecione...</option>
            {% for sala in salas %}
              <option value="{{ sala.id_sala }}">
                {{ sala.nome_sala }} ({{ sala.bloco }} ‚Äì Sala {{ sala.numero_sala }})
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group col-md-6">
          <label for="professor_id"><strong>2. Escolha o Professor Respons√°vel:</strong></label>
          <select name="professor_id" id="professor_id" class="form-control" required>
            <option selected disabled value="">Selecione...</option>
            {% for prof in professores %}
              <option value="{{ prof.id_professor }}">
                Prof. {{ prof.nome_completo }} ‚Äì {{ prof.departamento }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="form-row mt-3">
        <div class="form-group col-md-6">
          <label for="data"><strong>3. Escolha a Data:</strong></label>
          <input type="date" name="data" id="data" class="form-control" required>
        </div>

        <div class="form-group col-md-6">
          <label for="justificativa"><strong>4. Justificativa do uso:</strong></label>
          <textarea name="justificativa" id="justificativa" rows="3" class="form-control" placeholder="Descreva o motivo da solicita√ß√£o..."></textarea>
        </div>
      </div>

      <div class="form-group mt-4 text-right">
        <button type="button" class="btn btn-info" onclick="carregarHorarios()">üîç Ver Hor√°rios</button>
      </div>

      <hr />
      <h6 class="mt-4"><strong>5. Escolha o hor√°rio dispon√≠vel:</strong></h6>
      <div class="row my-4" id="grade-horarios">
        <p class="text-muted ml-3">Selecione uma sala e data para visualizar os hor√°rios dispon√≠veis.</p>
      </div>

      <div class="mb-4">
        <strong>Legenda:</strong><br>
        <span class="badge" style="background-color: #f8f9fa; color: #333;">‚¨ú Dispon√≠vel</span>
        <span class="badge badge-info text-white">üü¶ Selecionado</span>
        <span class="badge badge-success">üü© Confirmado</span>
        <span class="badge badge-warning text-dark">üü® Em processo</span>
        <span class="badge badge-secondary">üîò Outros</span>
      </div>

      <div class="text-right mb-4">
        <button type="submit" class="btn btn-success btn-lg">Solicitar Agendamento</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/aluno_dashboard.css') }}">
<script>
  function carregarHorarios() {
    const salaId = document.getElementById("sala_id").value;
    const data = document.getElementById("data").value;
    const grade = document.getElementById("grade-horarios");
    grade.innerHTML = "<p class='text-muted ml-3'>üîÑ Carregando hor√°rios...</p>";

    if (!salaId || !data) {
      grade.innerHTML = "<p class='text-danger ml-3'>Selecione uma sala e uma data v√°lida.</p>";
      return;
    }

    fetch(`/dashboard/aluno/horarios?sala_id=${salaId}&data=${data}`)
      .then(response => response.json())
      .then(horarios => {
        grade.innerHTML = "";
        if (!horarios.length) {
          grade.innerHTML = "<p class='text-muted ml-3'>Nenhum hor√°rio dispon√≠vel para esta data.</p>";
          return;
        }

        horarios.forEach(h => {
          grade.innerHTML += `
            <div class="col-md-4 mb-3">
              <label class="horario-slot d-block text-center py-3 px-2 rounded">
                <input 
                  type="radio" 
                  name="horario_id" 
                  value="${h.id}" 
                  class="d-none" 
                  data-status="${h.status}" 
                  ${h.status !== 'Dispon√≠vel' ? 'disabled' : ''}>
                ${h.texto}
              </label>
            </div>`;
        });
      });
  }
</script>
<script src="{{ url_for('static', filename='js/aluno_dashboard.js') }}"></script>
{% endblock %}
